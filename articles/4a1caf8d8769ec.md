---
title: "FirebaseAuthで独自ドメインを使う"
emoji: "🔥"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Firebase"]
published: true
---

# はじめに
Firebase Authenticationではメールアドレスの確認やパスワードのリセットなどの機能を提供していますが、デフォルトではFirebaseのドメインを使っています。

そのためデフォルトでは`noreply@<your-project-id>.firebaseapp.com`からメールが送信され、メール内のリンクも`https://<your-project-id>.firebaseapp.com/__/auth/action?mode=<action>&oobCode=<code>`のようなURLになります。

今回はFirebaseのドメインではなく独自ドメインを使う方法を簡単に紹介します。

# メールアドレスをカスタマイズ
こちらは簡単です。  
`Authentication` → `Template` → `メールアドレスの確認` など → 🖊アイコン（テンプレートを編集） → `ドメインをカスタマイズ`  
から指示に従えばOKです。  

http://zenn.dev/wake/articles/8b1a7f70d49af9

# メール内のリンク（アクションURL）をカスタマイズ
こちらは検索しても出てくる情報がバラバラだったので、私が試してうまく行った方法を紹介します。  
参考  
https://stackoverflow.com/questions/46972194/how-to-customize-firebase-action-url-for-password-reset-and-email-verification

ここでは大体3つの方法が紹介されていました。
* Dynamic Linksを設定してから、アクションURLを設定する
	* 2番目の方法を内包している上、サポート終了が予定されているので微妙
* ✅ Hostingにカスタムドメインを設定してから、アクションURLを設定する
* ❌ DNSを設定してから、アクションURLを設定する
	* `ERR_CERT_COMMON_NAME_INVALID`となってしまいます

2番目の方法でうまくいったので、こちらを紹介します。  

## Hostingにカスタムドメインを設定
`Hosting` → `ダッシュボード` → `カスタムドメインを追加`と進み、指示に従うだけです。  
* 「`yourdomain` を既存のウェブサイトにリダイレクトする」はチェックしなくて大丈夫です。  
* セットアップモードは「クイックセットアップ」で大丈夫です  
* **DNSを設定したらしばらく待ちます。**  

:::message
ダッシュボード上の表示が「設定が必要です」→「証明書を作成しています」→「接続されました」と遷移していくので待ちます。  
10~20分かかりました。
:::

## アクションURLをカスタマイズ
ダッシュボード上の表示が「接続されました」になったら、  
`Authentication` → `テンプレート` → `メールアドレスの確認` など → 🖊アイコン（テンプレートを編集） → `アクションURLをカスタマイズ` で
```
https://<your-custom-domain>/__/auth/action
```
と設定すればOKです。

# Dynamic Links
メールリンク認証などで使うDynamic Linksもカスタムドメインを使うことができますが、今回と同じ手順です。
Hostingでカスタムドメインを設定してから、Dynamic Linksを設定すればOKです。

一応「Dynamic Links」は2025年でサポート終了予定ですが、[AuthenticationのアクションURLは引き続き使えるようです](https://firebase.google.com/support/dynamic-links-faq?hl=ja#i_only_use_dynamic_links_for_firebase_authentication_will_email_link_authentication_in_firebase_authentication_continue_to_work)。

# おわりに
毎回調べては結局どの方法が正しいのか混乱していたので整理しました。  
そのため画像などの無い手抜き記事で失礼します。  
画像がほしい方は以下のリンクを参考にしてください。  
https://ifedapo.com/posts/customise-firebase-action-url
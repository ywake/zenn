---
title: "Flutterã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§Firebaseã¨é€šä¿¡(iOS)"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Flutter", "Firebase"]
published: true
---

# ã‚„ã‚ŠãŸã‹ã£ãŸã“ã¨
* [Workmanager](https://pub.dev/packages/workmanager)ã‚’ä½¿ã£ã¦Flutterã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ã‚’å®Ÿè£…
@[card](https://medium.com/vrt-digital-studio/flutter-workmanager-81e0cfbd6f6e)
* ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ã§ã¯Firebaseã¨é€šä¿¡
* (SwiftçŸ¥è­˜ãªã—)

# ã‚„ã£ãŸã“ã¨
* ã‚³ãƒ¼ãƒ‰ã¯[Workmanagerã®Docs](https://github.com/fluttercommunity/flutter_workmanager/blob/master/IOS_SETUP.md)ã©ãŠã‚Š
```dart:main.dart
void main() {
	// ...(ç•¥)
	Workmanager().initialize(
		callbackDispatcher,
		isInDebugMode: true,
	);
	runApp(new MyApp());
}

void callbackDispatcher() {
  Workmanager().executeTask((taskName, inputData) async {
    switch (taskName) {
      case Workmanager.iOSBackgroundTask:
        await Firebase.initializeApp();
        Firebase.doSomething(); // Firestoreã¨é€šä¿¡
        break;
    }
    bool success = true;
    return Future.value(success);
  });
}
```

```swift:AppDelegate.swift
import UIKit
import Flutter
import Firebase

@UIApplicationMain
@objc class AppDelegate: FlutterAppDelegate {
  override func application(
    _ application: UIApplication,
    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
  ) -> Bool {
    FirebaseApp.configure()
    GeneratedPluginRegistrant.register(with: self)
    UIApplication.shared.
    setMinimumBackgroundFetchInterval(TimeInterval(60*15)) // <- è¿½åŠ 
    return super.application(application, didFinishLaunchingWithOptions: launchOptions)
  }
}
```

# æ‚©ã¾ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼
:::message alert
MissingPluginException (No implementation found for method Firebase#initializeCore on channel plugins.flutter.io/firebase_core)
:::
ä¸€å¿œWorkmanagerã®Docsã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å°å…¥ã«ã¤ã„ã¦ã®èª¬æ˜ã¯ã‚ã‚Šã¾ã™ã€‚[ã“ã¡ã‚‰](https://github.com/fluttercommunity/flutter_workmanager/blob/master/IOS_SETUP.md#registered-plugins)
ã—ã‹ã—ã€`import workmanager`ã®èª¬æ˜ãŒæŠœã‘ã¦ã„ã¦
:::message alert
Cannot find 'WorkmanagerPlugin' in scope
:::
ã¨ãªã£ãŸã‚Šã€
ãã‚Œã‚’ç›´ã—ã¦ã‚‚
:::message alert
Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'Duplicate plugin key: FLTFirebaseFirestorePlugin'
:::
ã¨ãªã£ãŸã‚Šã€ã€ã€ï¼ˆç§ãŒè‹±èªã‚’ã¡ã‚ƒã‚“ã¨èª­ã‚“ã§ãªã„ã®ãŒåŸå› ã‹ã‚‚ï¼‰

ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®æµ·ã‚’å½·å¾¨ã£ã¦ã„ãŸã‚“ã§ã™ãŒã€issuesã®è™±æ½°ã—ã‚’å§‹ã‚ãŸã‚‰è§£æ±ºç­–ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚

# çµè«–
* Docsã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å°å…¥ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯åŒã˜å®Ÿè¡ŒãŒ2åº¦ã•ã‚Œã¦ã„ã¦`Duplicate`ã¨æ€’ã‚‰ã‚Œã¦ã„ãŸã ã‘ã§ã—ãŸã€‚
* ç›´æ¥çš„ãªé–¢ä¿‚ã¯ã‚ã¾ã‚Šãªã„ã§ã™ãŒã€ã“ã‚Œã§ã„ã„ã®ã‹ã¨ãªã£ãŸissueã¯[ã“ã¡ã‚‰](https://github.com/fluttercommunity/flutter_workmanager/issues/226#issuecomment-739531502)

```swift:AppDelegate.swift
import UIKit
import Flutter
import Firebase
import workmanager

@UIApplicationMain
@objc class AppDelegate: FlutterAppDelegate {
  override func application(
    _ application: UIApplication,
    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
  ) -> Bool {
    FirebaseApp.configure()
    GeneratedPluginRegistrant.register(with: self)
    UIApplication.shared.setMinimumBackgroundFetchInterval(TimeInterval(60*15))
    // â–¼ ã“ã‚Œã§ã„ã„
    WorkmanagerPlugin.setPluginRegistrantCallback { registry in
      GeneratedPluginRegistrant.register(with: registry)
    }
    return super.application(application, didFinishLaunchingWithOptions: launchOptions)
  }
}
```

# çµ‚ã‚ã‚Š
![](https://storage.googleapis.com/zenn-user-upload/2atl79q2ekjqb6ojj0w4xdd6pk18)
ä½™è«‡ã§ã™ãŒå®Ÿæ©Ÿã§è©¦ã—ãŸã‚‰æœ€åˆã®background fetchãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ã¾ã§15æ™‚é–“å¾…ã¡ã¾ã—ãŸâ€¦
Debugã§ã¯å‡ºæ¥ã¦ã‚‹ã—Releaseç”¨ã®è¨­å®šã‚‚å®Œç’§ãªã®ã«å®Ÿæ©Ÿã ã¨ä¸€å‘ã«æ¥ãªã„ï¼ã¨ã„ã†æ–¹ã€å®‰å¿ƒã—ã¦~~æœå ±~~fetchã¯å¯ã¦å¾…ã¡ã¾ã—ã‚‡ã†ã€‚
